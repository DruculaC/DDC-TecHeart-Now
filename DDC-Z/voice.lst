C51 COMPILER V9.54   VOICE                                                                 06/14/2017 16:44:54 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE VOICE
OBJECT MODULE PLACED IN .\voice.obj
COMPILER INVOKED BY: D:\Program Files\Keil_v5\C51\BIN\C51.EXE ..\Library\voice.c COMPACT ROM(COMPACT) OPTIMIZE(8,SPEED) 
                    -BROWSE INCDIR(..\Library) DEBUG OBJECTEXTEND PRINT(.\voice.lst) TABS(2) OBJECT(.\voice.obj)

line level    source

   1          /*---------------------------------------------------
   2            voice.c (v1.00)
   3            通C4
   4          ---------------------------------------------------*/
   5          
   6          #include "main.h"
   7          #include "port.h"
   8          
   9          #include "voice.h"
  10          #include "Delay.h"
  11          #include "communication.h"
  12          #include "Other.h"
  13          #include "battery.h"
  14          
  15          /*------ private variable --------------------------*/
  16          tByte key_rotate_on_speech_number = 1;    // 循环报两段开机语音
  17                                                      
  18          extern bit flashing_flag;
  19          extern tByte Open_action_flag;    
  20          extern bit slave_nearby_actioned_flag;
  21          extern bit ID_speeched_flag;
  22          extern tByte Check_Motobattery_count;
  23          extern bit Check_Motobattery_flag;
  24          extern bit EN_host_stolen_alarming;
  25          extern tWord load_battery_result;
  26          extern bit fell_flag;           
  27          extern bit raised_flag;       
  28          extern tWord ADC_check_result;    
  29          extern bit battery_stolen_EN;     
  30          extern bit never_alarm_speech;
  31          extern bit Speech_closed_G;
  32          extern tByte Speech_closed_time;
  33          
  34          
  35          /*--------------------------------------------------
  36            SC_Speech()
  37            按段数发送脉冲，即可报第几段语音。
  38          ---------------------------------------------------*/
  39          void SC_Speech(tByte cnt)
  40            {
  41   1        tByte ii;
  42   1        SC_RST = 1;
  43   1        Delay_50ms();
  44   1        SC_RST = 0;
  45   1        Delay_50ms();
  46   1        for(ii=0; ii < cnt; ii++)
  47   1          {
  48   2          SC_DATA = 1;
  49   2          delay_us(20);
  50   2          SC_DATA = 0;
  51   2          delay_us(20);
  52   2          }
  53   1        }
  54          
C51 COMPILER V9.54   VOICE                                                                 06/14/2017 16:44:54 PAGE 2   

  55          /*-------------------------------------------------
  56            InitVoice()
  57            Initialise Voice IC, shielding voice by accident on powerup.
  58          --------------------------------------------------*/
  59          void InitVoice()
  60            {
  61   1        P14=0;
  62   1        SC_DATA = 0;
  63   1        SC_RST = 1;
  64   1        delay_us(350); 
  65   1        SC_RST = 0;
  66   1        delay_us(350);
  67   1      //  P14 = 1;  
  68   1        voice_EN = 0;       // Close speaker.
  69   1        }
  70          
  71          /*----------------------------------------------------
  72            key_rotate_on_speech()
  73            钥匙旋转至ON后，语音提示
  74          -----------------------------------------------------*/
  75          void key_rotate_on_speech(void)
  76            {
  77   1        #ifdef Taili
                voice_EN = 1;
                SC_Speech(26);  
                Delay(100);
                voice_EN = 0;
                #endif
  83   1      
  84   1        #ifdef Shengbaolong
                voice_EN = 1;
                SC_Speech(5);  
                Delay(30);
                SC_Speech(6);  
                Delay(30);
                SC_Speech(4);  
                Delay(100); 
                voice_EN = 0; 
                #endif
  94   1        }
  95            
  96          /*-----------------------------------------------------
  97            key_rotate_off_speech()
  98            钥匙旋转到OFF后，语音提示
  99          void key_rotate_off_speech(void)
 100            {
 101            voice_EN = 1;
 102            SC_Speech(13);
 103            Delay(40);
 104            voice_EN = 0;
 105            }
 106          ------------------------------------------------------*/
 107          
 108          /*----------------------------------------------------
 109            motorBAT_low_speech()
 110            主机电瓶电量低于最小限定值，语音提示电量不足。
 111          -----------------------------------------------------*/
 112          void motorBAT_low_speech(void)
 113            {
 114   1        voice_EN = 1;
 115   1        SC_Speech(4);
 116   1        Delay(80);
C51 COMPILER V9.54   VOICE                                                                 06/14/2017 16:44:54 PAGE 3   

 117   1        voice_EN = 0;
 118   1        }
 119          
 120          /*----------------------------------------------------
 121            Battery_hint()
 122            第一次碰主机，会有一句提示语音
 123          --------------------------------------------------------*/
 124          void Battery_hint(void)
 125            {
 126   1        voice_EN = 1;
 127   1        SC_Speech(24); 
 128   1        Delay(1);
 129   1        voice_EN = 0;
 130   1        }
 131          
 132          /*----------------------------------------------------
 133            ID_speech()
 134            第一次碰主机，会有一句提示语音
 135          --------------------------------------------------------*/
 136          void ID_speech(void)
 137            {
 138   1        voice_EN = 1;
 139   1        SC_Speech(26); 
 140   1        Delay(30);
 141   1        voice_EN = 0;
 142   1      //  Speech_closed_G = 1;
 143   1      //  Speech_closed_time = 0;
 144   1        }
 145          
 146          /*----------------------------------------------------
 147            Self_learn_speech()
 148            第一次碰主机，会有一句提示语音
 149          --------------------------------------------------------*/
 150          void Self_learn_speech(void)
 151            {
 152   1        voice_EN = 1;
 153   1        Speech_closed_time = 0;
 154   1        SC_Speech(27); 
 155   1        Delay(30);
 156   1        voice_EN = 0;
 157   1        flashing_flag = 0;
 158   1        }
 159          
 160          /*----------------------------------------------------
 161            host_touch_speech()
 162            第一次碰主机，会有一句提示语音
 163          --------------------------------------------------------*/
 164          void host_touch_speech(void)
 165            {
 166   1        voice_EN = 1;
 167   1        SC_Speech(24);  
 168   1        Delay(50);
 169   1        voice_EN = 0;
 170   1        Delay(30);
 171   1        }
 172          
 173          /*-----------------------------------------------------
 174            host_2ndtouch_speech()
 175            第二次触碰主机，再报一个提示语音
 176          -------------------------------------------------------*/
 177          void host_2ndtouch_speech(void)
 178            {
C51 COMPILER V9.54   VOICE                                                                 06/14/2017 16:44:54 PAGE 4   

 179   1        voice_EN = 1;
 180   1        SC_Speech(24);  
 181   1        Delay(50);
 182   1        voice_EN = 0;
 183   1      //  Delay(10);
 184   1        }
 185            
 186          /*----------------------------------------------------
 187            stolen_alarm_speech()
 188            判断为被盗的时候，发出报警语音第一段
 189          ----------------------------------------------------*/
 190          void stolen_alarm_speech1(void)
 191            {
 192   1        voice_EN = 1;
 193   1        SC_Speech(24); 
 194   1        Delay(100);
 195   1        voice_EN = 0; 
 196   1        }
 197          
 198          /*----------------------------------------------------
 199            stolen_alarm_speech()
 200            判断为被盗的时候，发出报警语音第二段
 201          ----------------------------------------------------*/
 202           void stolen_alarm_speech2(void)
 203            {
 204   1        voice_EN = 1;
 205   1        SC_Speech(25); 
 206   1        Delay(180);
 207   1        voice_EN = 0;
 208   1        Delay(20);
 209   1        }
 210          
 211          /*----------------------------------------------------
 212            open_lock_speech()
 213            附机在主机附近，通过认证后，语音提示
 214          -----------------------------------------------------*/
 215          void open_lock_speech(void)
 216            {
 217   1        #ifdef Tailing
                voice_EN = 1;
                SC_Speech(24);  
                Delay(30);
                SC_Speech(6);  
                Delay(40);
                voice_EN = 0;
                #endif
 225   1      
 226   1        // 车锁已打开
 227   1        voice_EN=1;
 228   1        Speech_closed_time = 0;
 229   1        SC_Speech(22); 
 230   1        Delay(60);
 231   1        voice_EN=0;
 232   1        }
 233          
 234          /*----------------------------------------------------
 235            close_lock_speech()
 236            判断附机离开，语音提示
 237          -----------------------------------------------------*/
 238          void close_lock_speech(void)
 239            {
 240   1        voice_EN = 1;
C51 COMPILER V9.54   VOICE                                                                 06/14/2017 16:44:54 PAGE 5   

 241   1        SC_Speech(23);  
 242   1        Delay(60);
 243   1        voice_EN = 0;
 244   1        }
 245          
 246            /*----------------------------------------------------
 247            close_lock_dingdong_speech()
 248            亟芎k擢矛辕哟汀示
 249          -----------------------------------------------------*/
 250          void close_lock_dingdong_speech(void)
 251            {
 252   1        voice_EN = 1;
 253   1        SC_Speech(28);  
 254   1        Delay(60);
 255   1        voice_EN = 0;
 256   1        }
 257          
 258          /*----------------------------------------------------
 259            battery_stolen_speech()
 260            主机检测到电平不在时，语音提示电平被盗
 261          -----------------------------------------------------*/
 262          void battery_stolen_speech(void)
 263            {
 264   1        voice_EN = 1;
 265   1        SC_Speech(15);  
 266   1        Delay(100);
 267   1        voice_EN = 0;
 268   1        }
 269          
 270          /*----------------------------------------------------
 271            Cutting_Wire_Voice()
 272            有人剪断锁线的时候，播报的语音
 273          -----------------------------------------------------*/
 274          void Cutting_Wire_Voice(void)
 275            {
 276   1        voice_EN = 1;
 277   1        SC_Speech(28);  
 278   1        Delay(120);
 279   1        voice_EN = 0;
 280   1        }
 281          
 282          /*----------------------------------------------------
 283            Product_Test_Voice()
 284            测试程序中的语音提示
 285          -----------------------------------------------------*/
 286          void Product_Test_Voice(void)
 287            {
 288   1        voice_EN = 1;
 289   1        SC_Speech(21);  
 290   1        Delay(150);
 291   1        voice_EN = 0;
 292   1        }
 293          
 294          /*---------------------------------------------------------------
 295            Battery_low_alarm_speech()
 296            用于附机，当电池电量低于一定值，语音提示
 297          ----------------------------------------------------------------*/
 298          void Battery_low_alarm_speech(void)
 299            {
 300   1        voice_EN = 1;
 301   1        SC_Speech(6);
 302   1        Delay(80);
C51 COMPILER V9.54   VOICE                                                                 06/14/2017 16:44:54 PAGE 6   

 303   1        voice_EN = 0;
 304   1        }
 305          
 306          /*---------------------------------------------------------------
 307            Battery_high_alarm_speech()
 308            用于附机，电量高于一定值的时候，语音提示
 309          ----------------------------------------------------------------*/
 310          void Battery_high_alarm_speech(void)
 311            {
 312   1        voice_EN = 1;
 313   1        SC_Speech(5);
 314   1        Delay(50);
 315   1        voice_EN = 0;
 316   1        }
 317          
 318          /*-------------------------------------------------------------
 319            Alarm_stolen_speech()
 320            用于附机，主机被盗报警
 321          ---------------------------------------------------------------*/
 322          void Alarm_stolen_speech(void)
 323            {
 324   1        voice_EN = 1;
 325   1        SC_Speech(4);
 326   1        Delay(180);
 327   1        voice_EN = 0;
 328   1        }
 329            
 330          /*--------------------------------------------------------------
 331            Alarm_raised_speech()
 332            用于附机，主机被抬起报警
 333          ---------------------------------------------------------------*/
 334          void Alarm_raised_speech(void)
 335            {
 336   1        voice_EN = 1;
 337   1        SC_Speech(3);
 338   1        Delay(140);
 339   1        voice_EN = 0;
 340   1        }
 341            
 342          /*--------------------------------------------------------------
 343            Alarm_fell_speech()
 344            用于附机，主机倒地报警
 345          ----------------------------------------------------------------*/
 346          void Alarm_fell_speech(void)
 347            {
 348   1        voice_EN = 1;
 349   1        SC_Speech(2);
 350   1        Delay(120);
 351   1        voice_EN = 0;
 352   1        }
 353            
 354          /*---------------------------------------------------------------
 355            Host_battery_high_alarm_speech()
 356            用于附机，主机电量充满提示
 357          ---------------------------------------------------------------*/
 358          void Host_battery_high_alarm_speech(void)
 359            {
 360   1        voice_EN = 1;
 361   1        SC_Speech(11);  
 362   1        Delay(80);
 363   1        voice_EN = 0;
 364   1        }
C51 COMPILER V9.54   VOICE                                                                 06/14/2017 16:44:54 PAGE 7   

 365          
 366          /*---------------------------------------------------------------
 367            battery_stolen_speech_F3()
 368            用于附机，主机电池被盗报警
 369          ---------------------------------------------------------------*/
 370          void battery_stolen_speech_F3(void)
 371            {
 372   1        voice_EN = 1;
 373   1        SC_Speech(7);  
 374   1        Delay(50);
 375   1        voice_EN = 0;
 376   1        }
 377            
 378          /*---------------------------------------------------------------
 379            wire_broken_speech(void)
 380            用于附机，主机锁线被剪断报警
 381          ----------------------------------------------------------------*/
 382          void wire_broken_speech(void)
 383            {
 384   1        voice_EN = 1;
 385   1        SC_Speech(8);  
 386   1        Delay(80);
 387   1        voice_EN = 0; 
 388   1        }
 389          
 390          /*---------------------------------------------------------------
 391            lock_rotated_on_speech(void)
 392            用于附机，主机锁线被剪断报警
 393          ----------------------------------------------------------------*/
 394          void lock_rotated_on_speech(void)
 395            {
 396   1        voice_EN = 1;
 397   1        SC_Speech(12);  
 398   1        Delay(80);
 399   1        voice_EN = 0; 
 400   1        }
 401          /*---------------------------------------------------------------
 402            lock_rotated_off_speech(void)
 403            用于附机，主机锁线被剪断报警
 404          ----------------------------------------------------------------*/
 405          void lock_rotated_off_speech(void)
 406            {
 407   1        voice_EN = 1;
 408   1        SC_Speech(13);  
 409   1        Delay(80);
 410   1        voice_EN = 0; 
 411   1        }
 412          
 413          /*-------------------------------------------------------------
 414            IDcerted_speech()
 415          -------------------------------------------------------------*/
 416          void IDcerted_speech(void)
 417            {
 418   1        #ifdef ID
 419   1        ID_speech();
 420   1        #endif
 421   1        
 422   1        #ifdef WX
                if((Open_action_flag == 0)&&(slave_nearby_actioned_flag == 0)&&(ID_speeched_flag == 0))
                  {   
                  ID_speech();
                  
C51 COMPILER V9.54   VOICE                                                                 06/14/2017 16:44:54 PAGE 8   

                  ID_speeched_flag = 1;
                  }
                #endif
 430   1        }
 431          /*-------------------------------------------------------------
 432            Accumulator_voice_promot()
 433          -------------------------------------------------------------*/ 
 434          void Accumulator_voice_promot(void)
 435            {
 436   1        if(++Check_Motobattery_count > 3)
 437   1          {
 438   2          Check_Motobattery_count = 5;
 439   2          if((Check_Motobattery_flag == 1)&&(EN_host_stolen_alarming == 0)&&(fell_flag == 0)&&(raised_flag == 0)&&
             -(battery_stolen_EN == 0))
 440   2            {
 441   3            #ifdef BroadcastBattery
                    Broadcast_battery();    
                    #endif
 444   3            Check_Motobattery_flag = 0;
 445   3            }
 446   2          }
 447   1        }
 448          
 449          /*--------------------------------------------------------
 450            Enter_noguard_voice()
 451          --------------------------------------------------------*/
 452          void Enter_noguard_voice()
 453            {
 454   1        if(never_alarm_speech == 1)
 455   1          {
 456   2          never_alarm_speech = 0;
 457   2          Self_learn_speech();          
 458   2          } 
 459   1        }
 460            
 461          /*---------------------------------------------------
 462            end of file
 463          ----------------------------------------------------*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    489    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =      1       2
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
