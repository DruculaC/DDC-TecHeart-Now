C51 COMPILER V9.54   VOICE                                                                 09/06/2016 14:33:04 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE VOICE
OBJECT MODULE PLACED IN .\voice.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE ..\Library\voice.c COMPACT ROM(COMPACT) OPTIMIZE(8,S
                    -PEED) BROWSE INCDIR(..\Library) DEBUG OBJECTEXTEND PRINT(.\voice.lst) TABS(3) OBJECT(.\voice.obj)

line level    source

   1          /*---------------------------------------------------
   2             voice.c (v1.00)
   3             通用语音文件
   4             201603
   5          ---------------------------------------------------*/
   6          
   7          #include "main.h"
   8          #include "port.h"
   9          
  10          #include "voice.h"
  11          #include "Delay.h"
  12          #include "communication.h"
  13          #include "Other.h"
  14          #include "battery.h"
  15          
  16          /*------ private variable --------------------------*/
  17          tByte key_rotate_on_speech_number = 1;    // 循环报两段开机语音
  18                                                      
  19          extern bit flashing_flag;
  20          extern tByte Open_action_flag;      
  21          extern bit slave_nearby_actioned_flag;
  22          extern bit ID_speeched_flag;
  23          extern tByte Check_Motobattery_count;
  24          extern bit Check_Motobattery_flag;
  25          extern bit EN_host_stolen_alarming;
  26          extern tWord load_battery_result;
  27          extern bit fell_flag;                  
  28          extern bit raised_flag;          
  29          extern tWord ADC_check_result;      
  30          extern bit battery_stolen_EN;       
  31          extern bit never_alarm_speech;
  32           
  33          /*--------------------------------------------------
  34             SC_Speech()
  35             按段数发送脉冲，即可报第几段语音。
  36          ---------------------------------------------------*/
  37          void SC_Speech(tByte cnt)
  38             {
  39   1         tByte ii;
  40   1         SC_RST = 1;
  41   1         Delay_50ms();
  42   1         SC_RST = 0;
  43   1         Delay_50ms();
  44   1         for(ii=0; ii < cnt; ii++)
  45   1            {
  46   2            SC_DATA = 1;
  47   2            delay_us(20);
  48   2            SC_DATA = 0;
  49   2            delay_us(20);
  50   2            }
  51   1         }
  52          
  53          /*-------------------------------------------------
  54             InitVoice()
C51 COMPILER V9.54   VOICE                                                                 09/06/2016 14:33:04 PAGE 2   

  55             Initialise Voice IC, shielding voice by accident on powerup.
  56          --------------------------------------------------*/
  57          void InitVoice()
  58             {
  59   1         P14=0;
  60   1         SC_DATA = 0;
  61   1         SC_RST = 1;
  62   1         delay_us(350); 
  63   1         SC_RST = 0;
  64   1         delay_us(350);
  65   1      // P14 = 1; 
  66   1         voice_EN = 0;           // Close speaker.
  67   1         }
  68          
  69          /*----------------------------------------------------
  70             key_rotate_on_speech()
  71             钥匙旋转至ON后，语音提示
  72          -----------------------------------------------------*/
  73          void key_rotate_on_speech(void)
  74             {
  75   1         #ifdef Taili
                 voice_EN = 1;
                 SC_Speech(26);  
                 Delay(100);
                 voice_EN = 0;
                 #endif
  81   1      
  82   1         #ifdef Shengbaolong
                 voice_EN = 1;
                 SC_Speech(5);  
                 Delay(30);
                 SC_Speech(6);  
                 Delay(30);
                 SC_Speech(4);  
                 Delay(100); 
                 voice_EN = 0;  
                 #endif
  92   1         }
  93             
  94          /*-----------------------------------------------------
  95             key_rotate_off_speech()
  96             钥匙旋转到OFF后，语音提示
  97          void key_rotate_off_speech(void)
  98             {
  99             voice_EN = 1;
 100             SC_Speech(13);
 101             Delay(40);
 102             voice_EN = 0;
 103             }
 104          ------------------------------------------------------*/
 105          
 106          /*----------------------------------------------------
 107             motorBAT_low_speech()
 108             主机电瓶电量低于最小限定值，语音提示电量不足。
 109          -----------------------------------------------------*/
 110          void motorBAT_low_speech(void)
 111             {
 112   1         voice_EN = 1;
 113   1         SC_Speech(4);
 114   1         Delay(80);
 115   1         voice_EN = 0;
 116   1         }
C51 COMPILER V9.54   VOICE                                                                 09/06/2016 14:33:04 PAGE 3   

 117          
 118          /*----------------------------------------------------
 119             Battery_hint()
 120             第一次碰主机，会有一句提示语音
 121          --------------------------------------------------------*/
 122          void Battery_hint(void)
 123             {
 124   1         voice_EN = 1;
 125   1         SC_Speech(24); 
 126   1         Delay(1);
 127   1         voice_EN = 0;
 128   1         }
 129          
 130          /*----------------------------------------------------
 131             ID_speech()
 132             第一次碰主机，会有一句提示语音
 133          --------------------------------------------------------*/
 134          void ID_speech(void)
 135             {
 136   1         voice_EN = 1;
 137   1         SC_Speech(26); 
 138   1         Delay(30);
 139   1         voice_EN = 0;
 140   1         }
 141          
 142          /*----------------------------------------------------
 143             Self_learn_speech()
 144             第一次碰主机，会有一句提示语音
 145          --------------------------------------------------------*/
 146          void Self_learn_speech(void)
 147             {
 148   1         voice_EN = 1;
 149   1         SC_Speech(27); 
 150   1         Delay(30);
 151   1         voice_EN = 0;
 152   1         flashing_flag = 0;
 153   1         }
 154          
 155          /*----------------------------------------------------
 156             host_touch_speech()
 157             第一次碰主机，会有一句提示语音
 158          --------------------------------------------------------*/
 159          void host_touch_speech(void)
 160             {
 161   1         voice_EN = 1;
 162   1         SC_Speech(2);  
 163   1         Delay(90);
 164   1         voice_EN = 0;
 165   1         Delay(30);
 166   1         }
 167          
 168          /*-----------------------------------------------------
 169             host_2ndtouch_speech()
 170             第二次触碰主机，再报一个提示语音
 171          -------------------------------------------------------*/
 172          void host_2ndtouch_speech(void)
 173             {
 174   1         voice_EN = 1;
 175   1         SC_Speech(22);  
 176   1         Delay(140);
 177   1         voice_EN = 0;
 178   1      // Delay(10);
C51 COMPILER V9.54   VOICE                                                                 09/06/2016 14:33:04 PAGE 4   

 179   1         }
 180             
 181          /*----------------------------------------------------
 182             stolen_alarm_speech()
 183             判断为被盗的时候，发出报警语音第一段
 184          ----------------------------------------------------*/
 185          void stolen_alarm_speech1(void)
 186             {
 187   1         voice_EN = 1;
 188   1         SC_Speech(7); 
 189   1         Delay(60);
 190   1         voice_EN = 0; 
 191   1         }
 192          
 193          /*----------------------------------------------------
 194             stolen_alarm_speech()
 195             判断为被盗的时候，发出报警语音第二段
 196          ----------------------------------------------------*/
 197           void stolen_alarm_speech2(void)
 198             {
 199   1         voice_EN = 1;
 200   1         SC_Speech(3); 
 201   1         Delay(180);
 202   1         voice_EN = 0;
 203   1         Delay(20);
 204   1         }
 205          
 206          /*----------------------------------------------------
 207             open_lock_speech()
 208             附机在主机附近，通过认证后，语音提示
 209          -----------------------------------------------------*/
 210          void open_lock_speech(void)
 211             {
 212   1         #ifdef Tailing
                 voice_EN = 1;
                 SC_Speech(24);  
                 Delay(30);
                 SC_Speech(6);  
                 Delay(40);
                 voice_EN = 0;
                 #endif
 220   1      
 221   1         // 车锁已打开
 222   1         voice_EN=1;
 223   1         SC_Speech(9); 
 224   1         Delay(60);
 225   1         voice_EN=0;
 226   1         }
 227          
 228          /*----------------------------------------------------
 229             close_lock_speech()
 230             判断附机离开，语音提示
 231          -----------------------------------------------------*/
 232          void close_lock_speech(void)
 233             {
 234   1         voice_EN = 1;
 235   1         SC_Speech(10);  
 236   1         Delay(60);
 237   1         voice_EN = 0;
 238   1         }
 239          
 240          /*----------------------------------------------------
C51 COMPILER V9.54   VOICE                                                                 09/06/2016 14:33:04 PAGE 5   

 241             battery_stolen_speech()
 242             主机检测到电平不在时，语音提示电平被盗
 243          -----------------------------------------------------*/
 244          void battery_stolen_speech(void)
 245             {
 246   1         voice_EN = 1;
 247   1         SC_Speech(15);  
 248   1         Delay(100);
 249   1         voice_EN = 0;
 250   1         }
 251          
 252          /*----------------------------------------------------
 253             Cutting_Wire_Voice()
 254             有人剪断锁线的时候，播报的语音
 255          -----------------------------------------------------*/
 256          void Cutting_Wire_Voice(void)
 257             {
 258   1         voice_EN = 1;
 259   1         SC_Speech(28);  
 260   1         Delay(120);
 261   1         voice_EN = 0;
 262   1         }
 263          
 264          /*----------------------------------------------------
 265             Product_Test_Voice()
 266             测试程序中的语音提示
 267          -----------------------------------------------------*/
 268          void Product_Test_Voice(void)
 269             {
 270   1         voice_EN = 1;
 271   1         SC_Speech(21);  
 272   1         Delay(150);
 273   1         voice_EN = 0;
 274   1         }
 275          
 276          /*---------------------------------------------------------------
 277             Battery_low_alarm_speech()
 278             用于附机，当电池电量低于一定值，语音提示
 279          ----------------------------------------------------------------*/
 280          void Battery_low_alarm_speech(void)
 281             {
 282   1         voice_EN = 1;
 283   1         SC_Speech(6);
 284   1         Delay(80);
 285   1         voice_EN = 0;
 286   1         }
 287          
 288          /*---------------------------------------------------------------
 289             Battery_high_alarm_speech()
 290             用于附机，电量高于一定值的时候，语音提示
 291          ----------------------------------------------------------------*/
 292          void Battery_high_alarm_speech(void)
 293             {
 294   1         voice_EN = 1;
 295   1         SC_Speech(5);
 296   1         Delay(50);
 297   1         voice_EN = 0;
 298   1         }
 299          
 300          /*-------------------------------------------------------------
 301             Alarm_stolen_speech()
 302             用于附机，主机被盗报警
C51 COMPILER V9.54   VOICE                                                                 09/06/2016 14:33:04 PAGE 6   

 303          ---------------------------------------------------------------*/
 304          void Alarm_stolen_speech(void)
 305             {
 306   1         voice_EN = 1;
 307   1         SC_Speech(4);
 308   1         Delay(180);
 309   1         voice_EN = 0;
 310   1         }
 311             
 312          /*--------------------------------------------------------------
 313             Alarm_raised_speech()
 314             用于附机，主机被抬起报警
 315          ---------------------------------------------------------------*/
 316          void Alarm_raised_speech(void)
 317             {
 318   1         voice_EN = 1;
 319   1         SC_Speech(3);
 320   1         Delay(140);
 321   1         voice_EN = 0;
 322   1         }
 323             
 324          /*--------------------------------------------------------------
 325             Alarm_fell_speech()
 326             用于附机，主机倒地报警
 327          ----------------------------------------------------------------*/
 328          void Alarm_fell_speech(void)
 329             {
 330   1         voice_EN = 1;
 331   1         SC_Speech(2);
 332   1         Delay(120);
 333   1         voice_EN = 0;
 334   1         }
 335             
 336          /*---------------------------------------------------------------
 337             Host_battery_high_alarm_speech()
 338             用于附机，主机电量充满提示
 339          ---------------------------------------------------------------*/
 340          void Host_battery_high_alarm_speech(void)
 341             {
 342   1         voice_EN = 1;
 343   1         SC_Speech(11);  
 344   1         Delay(80);
 345   1         voice_EN = 0;
 346   1         }
 347          
 348          /*---------------------------------------------------------------
 349             battery_stolen_speech_F3()
 350             用于附机，主机电池被盗报警
 351          ---------------------------------------------------------------*/
 352          void battery_stolen_speech_F3(void)
 353             {
 354   1         voice_EN = 1;
 355   1         SC_Speech(7);  
 356   1         Delay(50);
 357   1         voice_EN = 0;
 358   1         }
 359             
 360          /*---------------------------------------------------------------
 361             wire_broken_speech(void)
 362             用于附机，主机锁线被剪断报警
 363          ----------------------------------------------------------------*/
 364          void wire_broken_speech(void)
C51 COMPILER V9.54   VOICE                                                                 09/06/2016 14:33:04 PAGE 7   

 365             {
 366   1         voice_EN = 1;
 367   1         SC_Speech(8);  
 368   1         Delay(80);
 369   1         voice_EN = 0;  
 370   1         }
 371          
 372          /*---------------------------------------------------------------
 373             lock_rotated_on_speech(void)
 374             用于附机，主机锁线被剪断报警
 375          ----------------------------------------------------------------*/
 376          void lock_rotated_on_speech(void)
 377             {
 378   1         voice_EN = 1;
 379   1         SC_Speech(12);  
 380   1         Delay(80);
 381   1         voice_EN = 0;  
 382   1         }
 383          /*---------------------------------------------------------------
 384             lock_rotated_off_speech(void)
 385             用于附机，主机锁线被剪断报警
 386          ----------------------------------------------------------------*/
 387          void lock_rotated_off_speech(void)
 388             {
 389   1         voice_EN = 1;
 390   1         SC_Speech(13);  
 391   1         Delay(80);
 392   1         voice_EN = 0;  
 393   1         }
 394          
 395          /*-------------------------------------------------------------
 396             IDcerted_speech()
 397          -------------------------------------------------------------*/
 398          void IDcerted_speech(void)
 399             {
 400   1         #ifdef ID
 401   1         ID_speech();
 402   1         #endif
 403   1         
 404   1         #ifdef WX
                 if((Open_action_flag == 0)&&(slave_nearby_actioned_flag == 0)&&(ID_speeched_flag == 0))
                    {     
                    ID_speech();
                    
                    ID_speeched_flag = 1;
                    }
                 #endif
 412   1         }
 413          /*-------------------------------------------------------------
 414             Accumulator_voice_promot()
 415          -------------------------------------------------------------*/   
 416          void Accumulator_voice_promot(void)
 417             {
 418   1         if(++Check_Motobattery_count > 3)
 419   1            {
 420   2            Check_Motobattery_count = 5;
 421   2            if((Check_Motobattery_flag == 1)&&(EN_host_stolen_alarming == 0)&&(fell_flag == 0)&&(raised_flag == 0)&&
             -(battery_stolen_EN == 0))
 422   2               {
 423   3               load_battery_result = ADC_check_result;
 424   3               verifybattery(load_battery_result);
 425   3               Check_Motobattery_flag = 0;
C51 COMPILER V9.54   VOICE                                                                 09/06/2016 14:33:04 PAGE 8   

 426   3               }
 427   2            }
 428   1         }
 429          
 430          /*--------------------------------------------------------
 431             Enter_noguard_voice()
 432          --------------------------------------------------------*/
 433          void Enter_noguard_voice()
 434             {
 435   1         if(never_alarm_speech == 1)
 436   1            {
 437   2            never_alarm_speech = 0;
 438   2            Self_learn_speech();             
 439   2            }  
 440   1         }
 441             
 442          /*---------------------------------------------------
 443             end of file
 444          ----------------------------------------------------*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    497    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =      1       2
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
