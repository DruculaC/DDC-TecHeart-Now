C51 COMPILER V9.54   BATTERY1506_4031C1                                                    06/06/2016 13:49:56 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE BATTERY1506_4031C1
OBJECT MODULE PLACED IN .\Battery1506_4031C1.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE ..\Library\Battery1506_4031C1.c COMPACT ROM(COMPACT)
                    - OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Library) DEBUG OBJECTEXTEND PRINT(.\Battery1506_4031C1.lst) TABS(3) OBJECT(.\Battery
                    -1506_4031C1.obj)

line level    source

   1          /*---------------------------------------------------
   2             Batteryold_4031C1.c (v1.00)
   3             old
   4             电池电量判断
   5          ---------------------------------------------------*/ 
   6          
   7          #include "main.h"
   8          #include "port.h"
   9          
  10          #include "Batteryold_4031C1.h"
  11          #include "voice.h"
  12          #include "Delay.h"
  13          #include "AD.h"
  14          
  15          extern tWord ADC_check_result;      
  16          extern tByte Check2_stage;
  17          extern tByte Battery_level;
  18          
  19          /*----------------------------------------------------
  20             Z2_broadcast_battery()
  21             voice alarm for battery status with power module
  22          -----------------------------------------------------*/
  23          void Z2_broadcast_battery(tWord Check2)
  24             {  
  25   1         if(Check2 < 0x21f)
  26   1            Battery_level = 48;
  27   1         else if(Check2 > 0x224)
  28   1            Battery_level = 60;
  29   1            
  30   1         switch(Battery_level)
  31   1            {
  32   2            case 48:
  33   2               {
  34   3               // battery is sufficient, battery > 50.5V, 3.14V/4.93V
  35   3               if((Check2 >= 0x1ff))
  36   3                  {
  37   4                  voice_EN = 1;
  38   4                  SC_Speech(20);    
  39   4                  Delay(60);
  40   4                  voice_EN = 0;
  41   4                  }
  42   3               // 20km, 49.5V < battery < 50.5V, 3.08V/4.93V
  43   3               else if((Check2 < 0x1ff)&&(Check2 >= 0x1f7))    
  44   3                  {
  45   4                  voice_EN = 1;
  46   4                  SC_Speech(8);  
  47   4                  Delay(100);
  48   4                  voice_EN = 0;
  49   4                  }
  50   3               // 15km, 48.8V < battery < 49.5V, 3.03V/4.93V 
  51   3               else if((Check2 < 0x1f7)&&(Check2 >= 0x1ef))    
  52   3                  {
  53   4                  voice_EN = 1;
C51 COMPILER V9.54   BATTERY1506_4031C1                                                    06/06/2016 13:49:56 PAGE 2   

  54   4                  SC_Speech(7);     
  55   4                  Delay(100);
  56   4                  voice_EN = 0;
  57   4                  }
  58   3               // 10km, 48V < battery <48.8V, 2.99V/4.9V
  59   3               else if((Check2 < 0x1ef)&&(Check2 >= 0x1e6))    
  60   3                  {
  61   4                  voice_EN = 1;
  62   4                  SC_Speech(6);     
  63   4                  Delay(100);
  64   4                  voice_EN = 0;
  65   4                  }
  66   3               // 5km, 46.8V < battery < 48V, 2.91V/4.9V
  67   3               else if((Check2 < 0x1e6)&&(Check2 >= 0x1df))    
  68   3                  {
  69   4                  voice_EN =1;
  70   4                  SC_Speech(5);     
  71   4                  Delay(100);
  72   4                  voice_EN = 0;
  73   4                  }                     
  74   3               // battery is low, battery < 46.8V, 
  75   3               else if(Check2 < 0x1df)
  76   3                  {
  77   4                  motorBAT_low_speech();
  78   4                  }        
  79   3               }
  80   2            break;
  81   2            
  82   2            case 60:
  83   2               {
  84   3               // battery is sufficient, battery > 63.5V, 3.95V/4.93V
  85   3               if((Check2 >= 0x27e))
  86   3                  {
  87   4                  voice_EN = 1;
  88   4                  SC_Speech(20);    
  89   4                  Delay(60);
  90   4                  voice_EN = 0;
  91   4                  }
  92   3               // 35km, 62V < battery < 63.5V, 3.86V/4.93V
  93   3               else if((Check2 < 0x27e)&&(Check2 >= 0x26e))    
  94   3                  {
  95   4                  voice_EN = 1;
  96   4                  SC_Speech(9);  
  97   4                  Delay(100);
  98   4                  voice_EN = 0;
  99   4                  }
 100   3               // 20km, 60V < battery < 62V, 3.74V/4.93V
 101   3               else if((Check2 < 0x26e)&&(Check2 >= 0x25b))    
 102   3                  {
 103   4                  voice_EN = 1;
 104   4                  SC_Speech(8);  
 105   4                  Delay(100);
 106   4                  voice_EN = 0;
 107   4                  }
 108   3               // 15km, 59.3V < battery < 60V, 3.7V/4.93V 
 109   3               else if((Check2 < 0x25b)&&(Check2 >= 0x255))    
 110   3                  {
 111   4                  voice_EN = 1;
 112   4                  SC_Speech(7);     
 113   4                  Delay(100);
 114   4                  voice_EN = 0;
 115   4                  }
C51 COMPILER V9.54   BATTERY1506_4031C1                                                    06/06/2016 13:49:56 PAGE 3   

 116   3               // 10km, 58.3V < battery <59.3V, 3.64V/4.93V
 117   3               else if((Check2 < 0x255)&&(Check2 >= 0x24c))    
 118   3                  {
 119   4                  voice_EN = 1;
 120   4                  SC_Speech(6);     
 121   4                  Delay(100);
 122   4                  voice_EN = 0;
 123   4                  }
 124   3               // 5km, 57.6V < battery < 58.3V, 3.6V/4.93V
 125   3               else if((Check2 < 0x24c)&&(Check2 >= 0x244))    
 126   3                  {
 127   4                  voice_EN =1;
 128   4                  SC_Speech(5);     
 129   4                  Delay(100);
 130   4                  voice_EN = 0;
 131   4                  }                     
 132   3               // battery is low, battery < 57.6V, 
 133   3               else if(Check2 < 0x244)
 134   3                  {
 135   4                  motorBAT_low_speech();
 136   4                  }
 137   3               }
 138   2            }
 139   1         }
 140          
 141          /*----------------------------------------------------
 142             Z3_broadcast_battery()
 143             voice alarm for battery status with power module
 144          -----------------------------------------------------*/
 145          void Z3_broadcast_battery(tWord Check2)
 146             {  
 147   1         if(Check2 < 0x2a0)
 148   1            Battery_level = 48;
 149   1         else if(Check2 > 0x2a1)
 150   1            Battery_level = 60;
 151   1            
 152   1         switch(Battery_level)
 153   1            {
 154   2            case 48:
 155   2               {
 156   3               // battery is sufficient, battery > 50.5V, 3.14V/4.93V
 157   3               if((Check2 >= 0x261))
 158   3                  {
 159   4                  voice_EN = 1;
 160   4                  SC_Speech(20);    
 161   4                  Delay(60);
 162   4                  voice_EN = 0;
 163   4                  }
 164   3               // 20km, 49.5V < battery < 50.5V, 3.08V/4.93V
 165   3               else if((Check2 < 0x261)&&(Check2 >= 0x257))    
 166   3                  {
 167   4                  voice_EN = 1;
 168   4                  SC_Speech(8);  
 169   4                  Delay(100);
 170   4                  voice_EN = 0;
 171   4                  }
 172   3               // 15km, 48.8V < battery < 49.5V, 3.03V/4.93V 
 173   3               else if((Check2 < 0x257)&&(Check2 >= 0x24d))    
 174   3                  {
 175   4                  voice_EN = 1;
 176   4                  SC_Speech(7);     
 177   4                  Delay(100);
C51 COMPILER V9.54   BATTERY1506_4031C1                                                    06/06/2016 13:49:56 PAGE 4   

 178   4                  voice_EN = 0;
 179   4                  }
 180   3               // 10km, 48V < battery <48.8V, 2.99V/4.9V
 181   3               else if((Check2 < 0x24d)&&(Check2 >= 0x243))    
 182   3                  {
 183   4                  voice_EN = 1;
 184   4                  SC_Speech(6);     
 185   4                  Delay(100);
 186   4                  voice_EN = 0;
 187   4                  }
 188   3               // 5km, 46.8V < battery < 48V, 2.91V/4.9V
 189   3               else if((Check2 < 0x243)&&(Check2 >= 0x236))    
 190   3                  {
 191   4                  voice_EN =1;
 192   4                  SC_Speech(5);     
 193   4                  Delay(100);
 194   4                  voice_EN = 0;
 195   4                  }                     
 196   3               // battery is low, battery < 46.8V, 
 197   3               else if(Check2 < 0x236)
 198   3                  {
 199   4                  motorBAT_low_speech();
 200   4                  }        
 201   3               }
 202   2            break;
 203   2            
 204   2            case 60:
 205   2               {
 206   3               // battery is sufficient, battery > 63.5V, 3.95V/4.93V
 207   3               if((Check2 >= 0x2f9))
 208   3                  {
 209   4                  voice_EN = 1;
 210   4                  SC_Speech(20);    
 211   4                  Delay(60);
 212   4                  voice_EN = 0;
 213   4                  }
 214   3               // 35km, 62V < battery < 63.5V, 3.86V/4.93V
 215   3               else if((Check2 < 0x2f9)&&(Check2 >= 0x2e5))    
 216   3                  {
 217   4                  voice_EN = 1;
 218   4                  SC_Speech(9);  
 219   4                  Delay(100);
 220   4                  voice_EN = 0;
 221   4                  }
 222   3               // 20km, 60V < battery < 62V, 3.74V/4.93V
 223   3               else if((Check2 < 0x2e5)&&(Check2 >= 0x2cf))    
 224   3                  {
 225   4                  voice_EN = 1;
 226   4                  SC_Speech(8);  
 227   4                  Delay(100);
 228   4                  voice_EN = 0;
 229   4                  }
 230   3               // 15km, 59.3V < battery < 60V, 3.7V/4.93V 
 231   3               else if((Check2 < 0x2cf)&&(Check2 >= 0x2c7))    
 232   3                  {
 233   4                  voice_EN = 1;
 234   4                  SC_Speech(7);     
 235   4                  Delay(100);
 236   4                  voice_EN = 0;
 237   4                  }
 238   3               // 10km, 58.3V < battery <59.3V, 3.64V/4.93V
 239   3               else if((Check2 < 0x2c7)&&(Check2 >= 0x2bd))    
C51 COMPILER V9.54   BATTERY1506_4031C1                                                    06/06/2016 13:49:56 PAGE 5   

 240   3                  {
 241   4                  voice_EN = 1;
 242   4                  SC_Speech(6);     
 243   4                  Delay(100);
 244   4                  voice_EN = 0;
 245   4                  }
 246   3               // 5km, 57.6V < battery < 58.3V, 3.6V/4.93V
 247   3               else if((Check2 < 0x2bd)&&(Check2 >= 0x2b3))    
 248   3                  {
 249   4                  voice_EN =1;
 250   4                  SC_Speech(5);     
 251   4                  Delay(100);
 252   4                  voice_EN = 0;
 253   4                  }                     
 254   3               // battery is low, battery < 57.6V, 
 255   3               else if(Check2 < 0x2b3)
 256   3                  {
 257   4                  motorBAT_low_speech();
 258   4                  }
 259   3               }
 260   2            }
 261   1         }
 262          /*---------------------------------------------------
 263             end of file
 264          ----------------------------------------------------*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    812    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----       4
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
