C51 COMPILER V9.54   BATTERY                                                               04/29/2017 16:17:07 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE BATTERY
OBJECT MODULE PLACED IN .\Battery.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE ..\Library\Battery.c COMPACT ROM(COMPACT) OPTIMIZE(8
                    -,SPEED) BROWSE INCDIR(..\Library) DEBUG OBJECTEXTEND PRINT(.\Battery.lst) TABS(3) OBJECT(.\Battery.obj)

line level    source

   1          /*---------------------------------------------------
   2             Battery.c (v1.00)
   3             Battery201603£¨70km60V£©r1
   4          ---------------------------------------------------*/
   5          
   6          #include "main.h"
   7          #include "port.h"
   8          
   9          #include "Battery.h"
  10          #include "voice.h"
  11          #include "Delay.h"
  12          #include "AD.h"
  13          #define Max_battery 0x291
  14          
  15          extern tWord ADC_check_result;      
  16          extern tWord load_battery_result;
  17          tByte Check2_stage = 0;
  18          tByte Battery_level = 0;
  19          
  20          /*----------------------------------------------------
  21             Check_motor_accumulator() - 48V µçÆ½
  22             Check P20's voltage.
  23          -----------------------------------------------------*/
  24          void Check_motor_accumulator(void)
  25             {
  26   1         // detect the battery voltage
  27   1         ADC_check_result = GetADCResult(6);
  28   1         }
  29          /*-----------------------------------------
  30             Broadcast_battery()
  31             
  32             ÄãºÃ
  33          ------------------------------------------*/
  34          void Broadcast_battery(void)
  35             {
  36   1         if((ADC_check_result < load_battery_result)||(ADC_check_result > Max_battery))
  37   1            {
  38   2            load_battery_result = ADC_check_result;
  39   2            }  
  40   1         verifybattery(load_battery_result);       
  41   1         }
  42          
  43          /*----------------------------------------------------
  44             verifybattery()
  45             voice alarm for battery status with power module
  46          -----------------------------------------------------*/
  47          void verifybattery(tWord Check2)
  48             {  
  49   1         #ifdef Kilometer_65
  50   1         // 
  51   1         voice_EN = 1;
  52   1         if(Check2<0x25f)
  53   1            {
  54   2            SC_Speech(39);       // ç”µé‡ä¸è¶³
C51 COMPILER V9.54   BATTERY                                                               04/29/2017 16:17:07 PAGE 2   

  55   2            Delay(50);
  56   2            }
  57   1         else if(Check2 > 0x291)
  58   1            {     
  59   2            SC_Speech(8);     
  60   2            Delay(70);        
  61   2            SC_Speech(18);       // 7
  62   2            Delay(30);
  63   2            SC_Speech(21);       // 10
  64   2            Delay(30);
  65   2            SC_Speech(11);    
  66   2            Delay(60);  
  67   2            }
  68   1            voice_EN = 0;
  69   1            SC_RST = 1;
  70   1            Delay_50ms();
  71   1            SC_RST = 0;
  72   1            Delay_50ms();
  73   1      
  74   1      /*    if(Check2 < 0x242)
  75   1               {
  76   1               SC_Speech(13);       // 2
  77   1               Delay(30);
  78   1               }
  79   1            else if((Check2 >= 0x242)&&(Check2 < 0x250))
  80   1               {
  81   1               SC_Speech(16);       // 5
  82   1               Delay(30);
  83   1               }
  84   1            else if((Check2 >= 0x250)&&(Check2 < 0x25f))
  85   1               {
  86   1               SC_Speech(21);       // 10
  87   1               Delay(30);
  88   1               }
  89   1         else if((Check2 >= 0x250)&&(Check2 < 0x25f))
  90   1               {
  91   1               SC_Speech(21);       // 10
  92   1               Delay(30);
  93   1               SC_Speech(17);       // 6
  94   1               Delay(30);
  95   1               }
  96   1            else if((Check2 >= 0x25f)&&(Check2 < 0x267))
  97   1               {
  98   1               SC_Speech(13);       // 2
  99   1               Delay(30);
 100   1               SC_Speech(21);       // 10
 101   1               Delay(30);
 102   1               SC_Speech(13);       // 2
 103   1               Delay(30);
 104   1               }
 105   1            else if((Check2 >= 0x267)&&(Check2 < 0x26f))
 106   1               {
 107   1               SC_Speech(13);       // 2
 108   1               Delay(30);
 109   1               SC_Speech(21);       // 10
 110   1               Delay(30);
 111   1               SC_Speech(19);       // 8
 112   1               Delay(30);
 113   1               }
 114   1            else if((Check2 >= 0x26f)&&(Check2 < 0x279))
 115   1               {
 116   1               SC_Speech(14);       // 3
C51 COMPILER V9.54   BATTERY                                                               04/29/2017 16:17:07 PAGE 3   

 117   1               Delay(30);
 118   1               SC_Speech(21);       // 10
 119   1               Delay(30);
 120   1               SC_Speech(15);       // 4
 121   1               Delay(30);
 122   1               }
 123   1            else if((Check2 >= 0x279)&&(Check2 < 0x282))
 124   1               {
 125   1               SC_Speech(15);       // 4
 126   1               Delay(30);
 127   1               SC_Speech(21);       // 10
 128   1               Delay(30);
 129   1               }
 130   1            else if((Check2 >= 0x282)&&(Check2 < 0x28a))
 131   1               {
 132   1               SC_Speech(15);       // 4
 133   1               Delay(30);
 134   1               SC_Speech(21);       // 10
 135   1               Delay(30);
 136   1               SC_Speech(17);       // 6
 137   1               Delay(30);
 138   1               }
 139   1            else if((Check2 >= 0x28a)&&(Check2 < 0x28e))
 140   1               {
 141   1               SC_Speech(16);       // 5
 142   1               Delay(30);
 143   1               SC_Speech(21);       // 10
 144   1               Delay(30);
 145   1               SC_Speech(13);       // 2
 146   1               Delay(30);
 147   1               }
 148   1            else if((Check2 >= 0x28e)&&(Check2 < 0x291))
 149   1               {
 150   1               SC_Speech(16);       // 5
 151   1               Delay(30);
 152   1               SC_Speech(21);       // 10
 153   1               Delay(30);
 154   1               SC_Speech(19);       // 8
 155   1               Delay(30);
 156   1               }
 157   1            else if((Check2 >= 0x291)&&(Check2 < Max_battery))
 158   1               {
 159   1               SC_Speech(17);       // 6
 160   1               Delay(30);
 161   1               SC_Speech(21);       // 10
 162   1               Delay(30);
 163   1               SC_Speech(15);       // 4
 164   1               Delay(30);
 165   1               }
 166   1            else if(Check2 >= Max_battery)
 167   1               {
 168   1               SC_Speech(18);       // 7
 169   1               Delay(30);
 170   1               SC_Speech(21);       // 10
 171   1               Delay(30);
 172   1               }  
 173   1            //
 174   1            SC_Speech(11);    
 175   1            Delay(60);  
 176   1         */    
 177   1         #endif
 178   1         }
C51 COMPILER V9.54   BATTERY                                                               04/29/2017 16:17:07 PAGE 4   

 179             
 180          /*---------------------------------------------------
 181             end of file
 182          ----------------------------------------------------*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    149    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =      2       2
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
