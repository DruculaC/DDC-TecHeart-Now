C51 COMPILER V9.54   BATTERY                                                               01/04/2017 15:10:32 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE BATTERY
OBJECT MODULE PLACED IN .\Battery.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE ..\Library\Battery.c COMPACT ROM(COMPACT) OPTIMIZE(8
                    -,SPEED) BROWSE INCDIR(..\Library) DEBUG OBJECTEXTEND PRINT(.\Battery.lst) TABS(3) OBJECT(.\Battery.obj)

line level    source

   1          /*---------------------------------------------------
   2             Battery.c (v1.00)
   3             Battery201603（110km72V）r1
   4          ---------------------------------------------------*/
   5          
   6          #include "main.h"
   7          #include "port.h"
   8          
   9          #include "Battery.h"
  10          #include "voice.h"
  11          #include "Delay.h"
  12          #include "AD.h"
  13          #define Max_battery 0x311
  14          
  15          extern tWord ADC_check_result;      
  16          extern tWord load_battery_result;
  17          tByte Check2_stage = 0;
  18          tByte Battery_level = 0;
  19          
  20          /*----------------------------------------------------
  21             Check_motor_accumulator() - 48V 电平
  22             Check P20's voltage.
  23          -----------------------------------------------------*/
  24          void Check_motor_accumulator(void)
  25             {
  26   1         // detect the battery voltage
  27   1         ADC_check_result = GetADCResult(6);
  28   1         }
  29          /*-----------------------------------------
  30             Broadcast_battery()
  31             
  32             你好
  33          ------------------------------------------*/
  34          void Broadcast_battery(void)
  35             {
  36   1         if((ADC_check_result < load_battery_result)||(ADC_check_result > Max_battery))
  37   1            {
  38   2            load_battery_result = ADC_check_result;
  39   2            }  
  40   1      
  41   1         verifybattery(load_battery_result);       
  42   1         }
  43          
  44          
  45          /*----------------------------------------------------
  46             verifybattery()
  47             voice alarm for battery status with power module
  48          -----------------------------------------------------*/
  49          void verifybattery(tWord Check2)
  50             {  
  51   1         #ifdef Kilometer_65
  52   1         voice_EN = 1;
  53   1         if(Check2 < 0x2d8)
  54   1            {
C51 COMPILER V9.54   BATTERY                                                               01/04/2017 15:10:32 PAGE 2   

  55   2            SC_Speech(39);
  56   2            Delay(50);
  57   2            }
  58   1         else if(Check2 > 0x311)
  59   1            {     
  60   2            SC_Speech(8);        // 甸杩借椹   
  61   2            Delay(70);        
  62   2            SC_Speech(12);       // 1
  63   2            Delay(30);
  64   2            SC_Speech(30);       // 100
  65   2            Delay(30);
  66   2            SC_Speech(12);       // 1
  67   2            Delay(30);
  68   2            SC_Speech(21);       // 10
  69   2            Delay(30);
  70   2            SC_Speech(11);       // 
  71   2            Delay(60);  
  72   2            }
  73   1            voice_EN = 0;
  74   1            SC_RST = 1;
  75   1            Delay_50ms();
  76   1            SC_RST = 0;
  77   1            Delay_50ms();
  78   1      
  79   1      
  80   1      /*
  81   1         voice_EN = 1;
  82   1         SC_Speech(8);     
  83   1         Delay(70);  
  84   1         // 多少
  85   1         if(Check2 < 0x2a8)
  86   1            {
  87   1            SC_Speech(14);       // 3
  88   1            Delay(30);
  89   1            }
  90   1         else if((Check2 >= 0x2a8)&&(Check2 < 0x2b6))
  91   1            {
  92   1            SC_Speech(19);       // 8
  93   1            Delay(30);
  94   1            }
  95   1         else if((Check2 >= 0x2b6)&&(Check2 < 0x2c7))
  96   1            {
  97   1            SC_Speech(21);       // 10
  98   1            Delay(30);
  99   1            SC_Speech(16);       // 5
 100   1            Delay(30);
 101   1            }
 102   1         else if((Check2 >= 0x2c7)&&(Check2 < 0x2d8))
 103   1            {
 104   1            SC_Speech(13);       // 2
 105   1            Delay(30);
 106   1            SC_Speech(21);       // 10
 107   1            Delay(30);
 108   1            SC_Speech(16);       // 5
 109   1            Delay(30);
 110   1            }
 111   1         else if((Check2 >= 0x2d8)&&(Check2 < 0x2e2))
 112   1            {
 113   1            SC_Speech(14);       // 3
 114   1            Delay(30);
 115   1            SC_Speech(21);       // 10
 116   1            Delay(30);
C51 COMPILER V9.54   BATTERY                                                               01/04/2017 15:10:32 PAGE 3   

 117   1            SC_Speech(15);       // 4
 118   1            Delay(30);
 119   1            }
 120   1         else if((Check2 >= 0x2e2)&&(Check2 < 0x2ec))
 121   1            {
 122   1            SC_Speech(15);       // 4
 123   1            Delay(30);
 124   1            SC_Speech(21);       // 10
 125   1            Delay(30);
 126   1            SC_Speech(15);       // 4
 127   1            Delay(30);
 128   1            }
 129   1         else if((Check2 >= 0x2ec)&&(Check2 < 0x2f7))
 130   1            {
 131   1            SC_Speech(16);       // 5
 132   1            Delay(30);
 133   1            SC_Speech(21);       // 10
 134   1            Delay(30);
 135   1            SC_Speech(14);       // 3
 136   1            Delay(30);
 137   1            }
 138   1         else if((Check2 >= 0x2f7)&&(Check2 < 0x302))
 139   1            {
 140   1            SC_Speech(17);       // 6
 141   1            Delay(30);
 142   1            SC_Speech(21);       // 10
 143   1            Delay(30);
 144   1            SC_Speech(14);       // 3
 145   1            Delay(30);
 146   1            }
 147   1         else if((Check2 >= 0x302)&&(Check2 < 0x30c))
 148   1            {
 149   1            SC_Speech(18);       // 7
 150   1            Delay(30);
 151   1            SC_Speech(21);       // 10
 152   1            Delay(30);
 153   1            SC_Speech(13);       // 2
 154   1            Delay(30);
 155   1            }
 156   1         else if((Check2 >= 0x30c)&&(Check2 < 0x311))
 157   1            {
 158   1            SC_Speech(19);       // 8
 159   1            Delay(30);
 160   1            SC_Speech(21);       // 10
 161   1            Delay(30);
 162   1            SC_Speech(12);       // 1
 163   1            Delay(30);
 164   1            }
 165   1         else if((Check2 >= 0x311)&&(Check2 < 0x315))
 166   1            {
 167   1            SC_Speech(20);       // 9
 168   1            Delay(30);
 169   1            SC_Speech(21);       // 10
 170   1            Delay(30);
 171   1            SC_Speech(12);       // 1
 172   1            Delay(30);
 173   1            }
 174   1         else if((Check2 >= 0x315)&&(Check2 < 0x317))
 175   1            {
 176   1            SC_Speech(12);       // 1
 177   1            Delay(30);
 178   1            SC_Speech(30);       // 100
C51 COMPILER V9.54   BATTERY                                                               01/04/2017 15:10:32 PAGE 4   

 179   1            Delay(30);
 180   1            }
 181   1         else if(Check2 >= 0x317)
 182   1            {
 183   1            SC_Speech(12);       // 1
 184   1            Delay(30);
 185   1            SC_Speech(30);       // 100
 186   1            Delay(30);
 187   1            SC_Speech(12);       // 1
 188   1            Delay(30);
 189   1            SC_Speech(21);       // 10
 190   1            Delay(30);
 191   1            }     
 192   1         // 公里
 193   1         SC_Speech(11);    
 194   1         Delay(60);  
 195   1         voice_EN = 0;
 196   1         SC_RST = 1;
 197   1         Delay_50ms();
 198   1         SC_RST = 0;
 199   1         Delay_50ms();
 200   1      */
 201   1         #endif
 202   1         }
 203             
 204          /*---------------------------------------------------
 205             end of file
 206          ----------------------------------------------------*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    169    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =      2       2
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
