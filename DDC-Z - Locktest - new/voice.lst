C51 COMPILER V9.54   VOICE                                                                 11/15/2016 11:44:55 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE VOICE
OBJECT MODULE PLACED IN .\voice.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE ..\Library\voice.c COMPACT ROM(COMPACT) OPTIMIZE(8,S
                    -PEED) BROWSE INCDIR(..\Library) DEBUG OBJECTEXTEND PRINT(.\voice.lst) TABS(3) OBJECT(.\voice.obj)

line level    source

   1          /*---------------------------------------------------
   2             voice.c (v1.00)
   3             通用语音文件
   4             201603
   5          ---------------------------------------------------*/
   6          
   7          #include "main.h"
   8          #include "port.h"
   9          
  10          #include "voice.h"
  11          #include "Delay.h"
  12          #include "communication.h"
  13          #include "Other.h"
  14          #include "battery.h"
  15          
  16          /*------ private variable --------------------------*/
  17          tByte key_rotate_on_speech_number = 1;    // 循环报两段开机语音
  18                                                      
  19          extern bit flashing_flag;
  20          extern tByte Open_action_flag;      
  21          extern bit slave_nearby_actioned_flag;
  22          extern bit ID_speeched_flag;
  23          extern tByte Check_Motobattery_count;
  24          extern bit Check_Motobattery_flag;
  25          extern bit EN_host_stolen_alarming;
  26          extern tWord load_battery_result;
  27          extern bit fell_flag;                  
  28          extern bit raised_flag;          
  29          extern tWord ADC_check_result;      
  30          extern bit battery_stolen_EN;       
  31          extern bit never_alarm_speech;
  32          extern bit Speech_closed_G;
  33          extern tByte Speech_closed_time;
  34          
  35          
  36          /*--------------------------------------------------
  37             SC_Speech()
  38             按段数发送脉冲，即可报第几段语音。
  39          ---------------------------------------------------*/
  40          void SC_Speech(tByte cnt)
  41             {
  42   1         tByte ii;
  43   1         SC_RST = 1;
  44   1         Delay_50ms();
  45   1         SC_RST = 0;
  46   1         Delay_50ms();
  47   1         for(ii=0; ii < cnt; ii++)
  48   1            {
  49   2            SC_DATA = 1;
  50   2            delay_us(20);
  51   2            SC_DATA = 0;
  52   2            delay_us(20);
  53   2            }
  54   1         }
C51 COMPILER V9.54   VOICE                                                                 11/15/2016 11:44:55 PAGE 2   

  55          
  56          /*-------------------------------------------------
  57             InitVoice()
  58             Initialise Voice IC, shielding voice by accident on powerup.
  59          --------------------------------------------------*/
  60          void InitVoice()
  61             {
  62   1         P14=0;
  63   1         SC_DATA = 0;
  64   1         SC_RST = 1;
  65   1         delay_us(350); 
  66   1         SC_RST = 0;
  67   1         delay_us(350);
  68   1      // P14 = 1; 
  69   1         voice_EN = 0;           // Close speaker.
  70   1         }
  71          
  72          /*----------------------------------------------------
  73             key_rotate_on_speech()
  74             钥匙旋转至ON后，语音提示
  75          -----------------------------------------------------*/
  76          void key_rotate_on_speech(void)
  77             {
  78   1         #ifdef Taili
                 voice_EN = 1;
                 SC_Speech(26);  
                 Delay(100);
                 voice_EN = 0;
                 #endif
  84   1      
  85   1         #ifdef Shengbaolong
                 voice_EN = 1;
                 SC_Speech(5);  
                 Delay(30);
                 SC_Speech(6);  
                 Delay(30);
                 SC_Speech(4);  
                 Delay(100); 
                 voice_EN = 0;  
                 #endif
  95   1         }
  96             
  97          /*-----------------------------------------------------
  98             key_rotate_off_speech()
  99             钥匙旋转到OFF后，语音提示
 100          void key_rotate_off_speech(void)
 101             {
 102             voice_EN = 1;
 103             SC_Speech(13);
 104             Delay(40);
 105             voice_EN = 0;
 106             }
 107          ------------------------------------------------------*/
 108          
 109          /*----------------------------------------------------
 110             motorBAT_low_speech()
 111             主机电瓶电量低于最小限定值，语音提示电量不足。
 112          -----------------------------------------------------*/
 113          void motorBAT_low_speech(void)
 114             {
 115   1         voice_EN = 1;
 116   1         SC_Speech(4);
C51 COMPILER V9.54   VOICE                                                                 11/15/2016 11:44:55 PAGE 3   

 117   1         Delay(80);
 118   1         voice_EN = 0;
 119   1         }
 120          
 121          /*----------------------------------------------------
 122             Battery_hint()
 123             第一次碰主机，会有一句提示语音
 124          --------------------------------------------------------*/
 125          void Battery_hint(void)
 126             {
 127   1         voice_EN = 1;
 128   1         SC_Speech(24); 
 129   1         Delay(1);
 130   1         voice_EN = 0;
 131   1         }
 132          
 133          /*----------------------------------------------------
 134             ID_speech()
 135             第一次碰主机，会有一句提示语音
 136          --------------------------------------------------------*/
 137          void ID_speech(void)
 138             {
 139   1         voice_EN = 1;
 140   1         SC_Speech(26); 
 141   1         Delay(30);
 142   1         Speech_closed_G = 1;
 143   1         Speech_closed_time = 0;
 144   1         }
 145          
 146          /*----------------------------------------------------
 147             Self_learn_speech()
 148             第一次碰主机，会有一句提示语音
 149          --------------------------------------------------------*/
 150          void Self_learn_speech(void)
 151             {
 152   1         voice_EN = 1;
 153   1         Speech_closed_time = 0;
 154   1         SC_Speech(27); 
 155   1         Delay(30);
 156   1         voice_EN = 0;
 157   1         flashing_flag = 0;
 158   1         }
 159          
 160          /*----------------------------------------------------
 161             host_touch_speech()
 162             第一次碰主机，会有一句提示语音
 163          --------------------------------------------------------*/
 164          void host_touch_speech(void)
 165             {
 166   1         voice_EN = 1;
 167   1         SC_Speech(2);  
 168   1         Delay(90);
 169   1         voice_EN = 0;
 170   1         Delay(30);
 171   1         }
 172          
 173          /*-----------------------------------------------------
 174             host_2ndtouch_speech()
 175             第二次触碰主机，再报一个提示语音
 176          -------------------------------------------------------*/
 177          void host_2ndtouch_speech(void)
 178             {
C51 COMPILER V9.54   VOICE                                                                 11/15/2016 11:44:55 PAGE 4   

 179   1         voice_EN = 1;
 180   1         SC_Speech(22);  
 181   1         Delay(140);
 182   1         voice_EN = 0;
 183   1      // Delay(10);
 184   1         }
 185             
 186          /*----------------------------------------------------
 187             stolen_alarm_speech()
 188             判断为被盗的时候，发出报警语音第一段
 189          ----------------------------------------------------*/
 190          void stolen_alarm_speech1(void)
 191             {
 192   1         voice_EN = 1;
 193   1         SC_Speech(7); 
 194   1         Delay(60);
 195   1         voice_EN = 0; 
 196   1         }
 197          
 198          /*----------------------------------------------------
 199             stolen_alarm_speech()
 200             判断为被盗的时候，发出报警语音第二段
 201          ----------------------------------------------------*/
 202           void stolen_alarm_speech2(void)
 203             {
 204   1         voice_EN = 1;
 205   1         SC_Speech(3); 
 206   1         Delay(180);
 207   1         voice_EN = 0;
 208   1         Delay(20);
 209   1         }
 210          
 211          /*----------------------------------------------------
 212             open_lock_speech()
 213             附机在主机附近，通过认证后，语音提示
 214          -----------------------------------------------------*/
 215          void open_lock_speech(void)
 216             {
 217   1         #ifdef Tailing
                 voice_EN = 1;
                 SC_Speech(24);  
                 Delay(30);
                 SC_Speech(6);  
                 Delay(40);
                 voice_EN = 0;
                 #endif
 225   1      
 226   1         // 车锁已打开
 227   1         voice_EN=1;
 228   1         Speech_closed_time = 0;
 229   1         SC_Speech(9); 
 230   1         Delay(60);
 231   1         voice_EN=0;
 232   1         }
 233          
 234          /*----------------------------------------------------
 235             close_lock_speech()
 236             判断附机离开，语音提示
 237          -----------------------------------------------------*/
 238          void close_lock_speech(void)
 239             {
 240   1         voice_EN = 1;
C51 COMPILER V9.54   VOICE                                                                 11/15/2016 11:44:55 PAGE 5   

 241   1         SC_Speech(10);  
 242   1         Delay(60);
 243   1         voice_EN = 0;
 244   1         }
 245          
 246          /*----------------------------------------------------
 247             battery_stolen_speech()
 248             主机检测到电平不在时，语音提示电平被盗
 249          -----------------------------------------------------*/
 250          void battery_stolen_speech(void)
 251             {
 252   1         voice_EN = 1;
 253   1         SC_Speech(15);  
 254   1         Delay(100);
 255   1         voice_EN = 0;
 256   1         }
 257          
 258          /*----------------------------------------------------
 259             Cutting_Wire_Voice()
 260             有人剪断锁线的时候，播报的语音
 261          -----------------------------------------------------*/
 262          void Cutting_Wire_Voice(void)
 263             {
 264   1         voice_EN = 1;
 265   1         SC_Speech(28);  
 266   1         Delay(120);
 267   1         voice_EN = 0;
 268   1         }
 269          
 270          /*----------------------------------------------------
 271             Product_Test_Voice()
 272             测试程序中的语音提示
 273          -----------------------------------------------------*/
 274          void Product_Test_Voice(void)
 275             {
 276   1         voice_EN = 1;
 277   1         SC_Speech(21);  
 278   1         Delay(150);
 279   1         voice_EN = 0;
 280   1         }
 281          
 282          /*---------------------------------------------------------------
 283             Battery_low_alarm_speech()
 284             用于附机，当电池电量低于一定值，语音提示
 285          ----------------------------------------------------------------*/
 286          void Battery_low_alarm_speech(void)
 287             {
 288   1         voice_EN = 1;
 289   1         SC_Speech(6);
 290   1         Delay(80);
 291   1         voice_EN = 0;
 292   1         }
 293          
 294          /*---------------------------------------------------------------
 295             Battery_high_alarm_speech()
 296             用于附机，电量高于一定值的时候，语音提示
 297          ----------------------------------------------------------------*/
 298          void Battery_high_alarm_speech(void)
 299             {
 300   1         voice_EN = 1;
 301   1         SC_Speech(5);
 302   1         Delay(50);
C51 COMPILER V9.54   VOICE                                                                 11/15/2016 11:44:55 PAGE 6   

 303   1         voice_EN = 0;
 304   1         }
 305          
 306          /*-------------------------------------------------------------
 307             Alarm_stolen_speech()
 308             用于附机，主机被盗报警
 309          ---------------------------------------------------------------*/
 310          void Alarm_stolen_speech(void)
 311             {
 312   1         voice_EN = 1;
 313   1         SC_Speech(4);
 314   1         Delay(180);
 315   1         voice_EN = 0;
 316   1         }
 317             
 318          /*--------------------------------------------------------------
 319             Alarm_raised_speech()
 320             用于附机，主机被抬起报警
 321          ---------------------------------------------------------------*/
 322          void Alarm_raised_speech(void)
 323             {
 324   1         voice_EN = 1;
 325   1         SC_Speech(3);
 326   1         Delay(140);
 327   1         voice_EN = 0;
 328   1         }
 329             
 330          /*--------------------------------------------------------------
 331             Alarm_fell_speech()
 332             用于附机，主机倒地报警
 333          ----------------------------------------------------------------*/
 334          void Alarm_fell_speech(void)
 335             {
 336   1         voice_EN = 1;
 337   1         SC_Speech(2);
 338   1         Delay(120);
 339   1         voice_EN = 0;
 340   1         }
 341             
 342          /*---------------------------------------------------------------
 343             Host_battery_high_alarm_speech()
 344             用于附机，主机电量充满提示
 345          ---------------------------------------------------------------*/
 346          void Host_battery_high_alarm_speech(void)
 347             {
 348   1         voice_EN = 1;
 349   1         SC_Speech(11);  
 350   1         Delay(80);
 351   1         voice_EN = 0;
 352   1         }
 353          
 354          /*---------------------------------------------------------------
 355             battery_stolen_speech_F3()
 356             用于附机，主机电池被盗报警
 357          ---------------------------------------------------------------*/
 358          void battery_stolen_speech_F3(void)
 359             {
 360   1         voice_EN = 1;
 361   1         SC_Speech(7);  
 362   1         Delay(50);
 363   1         voice_EN = 0;
 364   1         }
C51 COMPILER V9.54   VOICE                                                                 11/15/2016 11:44:55 PAGE 7   

 365             
 366          /*---------------------------------------------------------------
 367             wire_broken_speech(void)
 368             用于附机，主机锁线被剪断报警
 369          ----------------------------------------------------------------*/
 370          void wire_broken_speech(void)
 371             {
 372   1         voice_EN = 1;
 373   1         SC_Speech(8);  
 374   1         Delay(80);
 375   1         voice_EN = 0;  
 376   1         }
 377          
 378          /*---------------------------------------------------------------
 379             lock_rotated_on_speech(void)
 380             用于附机，主机锁线被剪断报警
 381          ----------------------------------------------------------------*/
 382          void lock_rotated_on_speech(void)
 383             {
 384   1         voice_EN = 1;
 385   1         SC_Speech(12);  
 386   1         Delay(80);
 387   1         voice_EN = 0;  
 388   1         }
 389          /*---------------------------------------------------------------
 390             lock_rotated_off_speech(void)
 391             用于附机，主机锁线被剪断报警
 392          ----------------------------------------------------------------*/
 393          void lock_rotated_off_speech(void)
 394             {
 395   1         voice_EN = 1;
 396   1         SC_Speech(13);  
 397   1         Delay(80);
 398   1         voice_EN = 0;  
 399   1         }
 400          
 401          /*-------------------------------------------------------------
 402             IDcerted_speech()
 403          -------------------------------------------------------------*/
 404          void IDcerted_speech(void)
 405             {
 406   1         #ifdef ID
 407   1         ID_speech();
 408   1         #endif
 409   1         
 410   1         #ifdef WX
                 if((Open_action_flag == 0)&&(slave_nearby_actioned_flag == 0)&&(ID_speeched_flag == 0))
                    {     
                    ID_speech();
                    
                    ID_speeched_flag = 1;
                    }
                 #endif
 418   1         }
 419          /*-------------------------------------------------------------
 420             Accumulator_voice_promot()
 421          -------------------------------------------------------------*/   
 422          void Accumulator_voice_promot(void)
 423             {
 424   1         if(++Check_Motobattery_count > 3)
 425   1            {
 426   2            Check_Motobattery_count = 5;
C51 COMPILER V9.54   VOICE                                                                 11/15/2016 11:44:55 PAGE 8   

 427   2            if((Check_Motobattery_flag == 1)&&(EN_host_stolen_alarming == 0)&&(fell_flag == 0)&&(raised_flag == 0)&&
             -(battery_stolen_EN == 0))
 428   2               {
 429   3               Broadcast_battery();       
 430   3               Check_Motobattery_flag = 0;
 431   3               }
 432   2            }
 433   1         }
 434          
 435          /*--------------------------------------------------------
 436             Enter_noguard_voice()
 437          --------------------------------------------------------*/
 438          void Enter_noguard_voice()
 439             {
 440   1         if(never_alarm_speech == 1)
 441   1            {
 442   2            never_alarm_speech = 0;
 443   2            Self_learn_speech();             
 444   2            }  
 445   1         }
 446             
 447          /*---------------------------------------------------
 448             end of file
 449          ----------------------------------------------------*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    493    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =      1       2
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
